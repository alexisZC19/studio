{
  "entities": {
    "Anime": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Anime",
      "type": "object",
      "description": "Represents an anime title with its core details.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Anime entity."
        },
        "title": {
          "type": "string",
          "description": "The title of the anime."
        },
        "description": {
          "type": "string",
          "description": "A brief summary or description of the anime."
        },
        "coverImageUri": {
          "type": "string",
          "description": "URI for the anime's cover image.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "title",
        "description",
        "coverImageUri"
      ]
    },
    "UserProfile": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserProfile",
      "type": "object",
      "description": "Represents a user profile.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the UserProfile entity."
        },
        "username": {
          "type": "string",
          "description": "The username of the user."
        },
        "email": {
          "type": "string",
          "description": "The email address of the user.",
          "format": "email"
        },
        "favoriteAnimeIds": {
          "type": "array",
          "description": "References to Anime entities. (Relationship: UserProfile 1:N Anime)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "username",
        "email"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "UserProfile",
          "schema": {
            "$ref": "#/backend/entities/UserProfile"
          },
          "description": "Stores user profile information. Path-based ownership ensures only the authenticated user can access their own profile data.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier of the user."
            }
          ]
        }
      },
      {
        "path": "/anime/{animeId}",
        "definition": {
          "entityName": "Anime",
          "schema": {
            "$ref": "#/backend/entities/Anime"
          },
          "description": "Stores anime data, accessible independently of user context for secure listing and retrieval.",
          "params": [
            {
              "name": "animeId",
              "description": "The unique identifier of the anime."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the AnimeVerse application, focusing on user profiles and anime data while adhering to the principles of Authorization Independence, Structural Segregation, and Access Modeling. \n\n1.  **User Profiles:** User profiles are stored under `/users/{userId}`. This path-based ownership simplifies security rules, ensuring only the authenticated user can access their own profile data. Each document stores essential user information.\n2.  **Anime Data:** Anime data is stored in a top-level collection called `/anime/{animeId}`. This ensures that access to anime data is independent of any user context, enabling secure listing and retrieval operations without requiring complex authorization logic.\n\n**Authorization Independence:**\nTo achieve authorization independence, the structure avoids relying on `get()` calls in security rules by denormalizing data where necessary. For instance, if collaborative features were introduced (e.g., user-created anime lists), the `members` map would be replicated within each list document to avoid hierarchical dependencies.\n\n**QAPs (Rules are not Filters):**\nThe structure supports secure `list` operations by segregating data with different access needs. Publicly accessible anime data resides in the `/anime` collection, where listing is permitted. User-specific data, such as profile information, is stored under `/users/{userId}`, ensuring that listing operations are restricted to the authenticated user's own data.\n\nThis structure promotes clarity, security, and scalability, aligning with the core design principles outlined in the prompt."
  }
}